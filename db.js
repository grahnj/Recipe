function db(){
	var db = Ti.Database.open('recipe');
	
	db.execute("BEGIN TRANSACTION;" +
	
		"-- Table: INGREDIENT" +
		"CREATE TABLE IF NOT EXISTS INGREDIENT (INGREDIENT_ID INTEGER (10) PRIMARY KEY UNIQUE NOT NULL, NAME VARCHAR (50) NOT NULL, AMOUNT DECIMAL (5) NOT NULL, MEASUREMENT_TYPE INTEGER (1) NOT NULL, MEASUREMENT_VALUE INTEGER (1) NOT NULL);" + 

		"-- Table: RECIPE_INGREDIENT" +
		"CREATE TABLE IF NOT EXISTS RECIPE_INGREDIENT (RECIPE_ID INTEGER (10) REFERENCES RECIPE (RECIPE_ID) ON DELETE CASCADE ON UPDATE CASCADE NOT NULL, INGREDIENT_ID INTEGER (10) REFERENCES INGREDIENT (INGREDIENT_ID) ON DELETE CASCADE ON UPDATE CASCADE NOT NULL);" +
		
		"-- Table: RECIPE_FILTER" +
		"CREATE TABLE IF NOT EXISTS RECIPE_FILTER (RECIPE_ID INTEGER (10) REFERENCES RECIPE (RECIPE_ID) ON DELETE CASCADE ON UPDATE CASCADE NOT NULL, FILTER_ID INTEGER (2) REFERENCES FILTER (FILTER_ID) ON DELETE CASCADE ON UPDATE CASCADE NOT NULL);" +
		
		"-- Table: STEP" +
		"CREATE TABLE IF NOT EXISTS STEP (ID INTEGER (10) PRIMARY KEY UNIQUE NOT NULL, STEP_NUMBER INTEGER (2) NOT NULL, DETAILS STRING (400) NOT NULL);" +
		
		"-- Table: RECIPE_STEP" +
		"CREATE TABLE IF NOT EXISTS RECIPE_STEP (RECIPE_ID INTEGER (2) REFERENCES RECIPE (RECIPE_ID) ON DELETE CASCADE ON UPDATE CASCADE NOT NULL, STEP_ID INTEGER (2) REFERENCES STEP (ID) ON DELETE CASCADE ON UPDATE CASCADE NOT NULL);" +
		
		"-- Table: MEASUREMENT_TYPE" +
		"CREATE TABLE IF NOT EXISTS MEASUREMENT_TYPE (ID INTEGER (1) PRIMARY KEY UNIQUE NOT NULL, NAME VARCHAR (20) NOT NULL, NAME_VALUE INTEGER(5) NOT NULL);" +
		
		"-- Table: FILTER" +
		"CREATE TABLE IF NOT EXISTS FILTER (FILTER_ID INTEGER (2) PRIMARY KEY UNIQUE NOT NULL, FILTER_NAME VARCHAR (50) NOT NULL UNIQUE);" +
		
		"-- Table: MEASUREMENT_TYPE_VALUE" +
		"CREATE TABLE IF NOT EXISTS MEASUREMENT_TYPE_VALUE (TYPE_ID INTEGER (2) REFERENCES MEASUREMENT_TYPE (ID) ON DELETE CASCADE ON UPDATE CASCADE NOT NULL, VALUE_ID INTEGER (2) REFERENCES MEASUREMENT_VALUE (ID) ON DELETE CASCADE ON UPDATE CASCADE);" +
		
		"-- Table: RECIPE" +
		"CREATE TABLE IF NOT EXISTS RECIPE (RECIPE_ID INTEGER (10) PRIMARY KEY UNIQUE NOT NULL, NAME VARCHAR (75) NOT NULL, YIELD INTEGER (5) NOT NULL, IS_STANDARD BOOLEAN NOT NULL);" +
		
		"-- Table: MEASUREMENT_VALUE" +
		"CREATE TABLE IF NOT EXISTS MEASUREMENT_VALUE (ID INTEGER (2) PRIMARY KEY UNIQUE NOT NULL, NAME VARCHAR (10) NOT NULL, NAME_VALUE INTEGER(5) NOT NULL);" +
		
		"COMMIT TRANSACTION;");

	function getRecipes(){
		return db.execute("SELECT RECIPE.RECIPE_ID, RECIPE.NAME, RECIPE.YIELD FROM RECIPE");	
	}
	
	function getIngredients(recipeID){
		return db.execute("" +
			"SELECT" +

			"INGREDIENT_ID, " +
			"NAME, " +
			"AMOUNT, " +
			"MEASUREMENT_TYPE.NAME_VALUE " +
			"MEASUREMENT_VALUE.NAME_VALUE " +
			
			"FROM INGREDIENT, MEASUREMENT_TYPE, MEASUREMENT_VALUE " +
			"INNER JOIN RECIPE_INGREDIENT " +
			"ON INGREDIENT.INGREDIENT_ID=RECIPE_INGREDIENT.INGREDIENT_ID " +
			"INNER JOIN MEASUREMENT_TYPE " +
			"ON INGREDIENT.MEASUREMENT_TYPE=MEASUREMENT_TYPE.ID " +
			"INNER JOIN MEASUREMENT_TYPE_VALUE " +
			"ON MEASUREMENT_TYPE_VALUE.TYPE_ID=MEASUREMENT_TYPE.ID " +
			"INNER JOIN MEASUREMENT_VALUE " +
			"ON MEASUREMENT_VALUE.ID=MEASUREMENT_TYPE_VALUE.ID " +
			
			"WHERE RECIPE.RECIPE_ID = ?", recipeID);	
	}
	
	function getFilters(recipeID){
		return db.execute("SELECT " +

			"FILTER_ID, " +
			"FILTER_NAME " +
			
			"FROM FILTER " +
			
			"INNER JOIN RECIPE_FILTER " +
			"ON RECIPE_FILTER.FILTER_ID=FILTER.FILTER_ID " +
			
			"WHERE RECIPE_FILTER.RECIPE_ID = ?", recipeID);
	}
	
	function getSteps(recipeID){
		return db.execute("SELECT " +

			"ID, " +
			"STEP_NUMBER " +
			"DETAILS " +
			
			"FROM STEP " +
			
			"INNER JOIN RECIPE_STEP " +
			"ON RECIPE_STEP.STEP_ID=STEP.ID " +
			
			"WHERE RECIPE_STEP.RECIPE_ID = ?" recipeID);	
	}

module.exports = db;
